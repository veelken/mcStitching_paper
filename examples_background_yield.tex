\section{Categorical probability distribution}
\label{sec:examples_background_yield}

In this Section we will discuss the case where the probability $p_{j}^{i}$ in Eq.~(\ref{eq:incl}) follows a categorical distribution.
The examples refer to DY and $\PW$+jets production at the LHC.
We will first discuss the stitching of $\PW \to \Plepton\Pnu$ samples generated at LO accuracy in pQCD based on the observable $N_{\jet}$, 
followed by a discussion of the stitching of $\PW \to \Plepton\Pnu$ samples generated at LO accuracy in pQCD based on the two observables $N_{\jet}$ and $\HT$,
before we conclude this Section with a discussion of stitching $\PZggx \to \Plepton\Plepton$ samples generated at NLO in pQCD based on the multiplicity of jets.
In all three cases, we will assume that an inclusive sample, covering the whole PS, is available.
The probabilities $p^{i}$ and $p_{j}^{i}$ in Eq.~(\ref{eq:incl})
are obtained by determining the fraction of events that fall into PS region $i$ in the inclusive sample and in the exclusive samples $j$, respectively.
In case no inclusive sample is available to obtain the probabilities $p^{i}$ and $p_{j}^{i}$,
one can determine these probabilities from the ratio of cross sections computed by the MC generator.

\subsection{Stitching of $\PW$+jets samples by $N_{\jet}$}
\label{sec:WJets_vs_Njet}

In case of the $\PW \to \Plepton\Pnu$ sample simulated at LO accuracy in pQCD,
the inclusive sample is stitched with samples of $N_{\jet} = 1$, $2$, $3$, and $N_{\jet} \geq 4$.
We divide the PS by the number of jets and set the index $i$ equal to $N_{\jet}$.
The number of events in each MC sample and the values of the $p^{i}$ and $p_{j}^{i}$ are given in Table~\ref{tab:samples_and_probabilities_WJets_vs_Njet}.
The corresponding stitching weights, computed according to Eq.~(\ref{eq:incl}), are given in Table~\ref{tab:weights_WJets_vs_Njet}.
The weights $w^{i}$ decrease as the number of jets increases, 
reflecting the reduction in statistical uncertainty that is achieved by using the exclusive samples in conjunction with the inclusive one.
In order to demonstrate that the stitching procedure yields background estimates that are unbiased,
we show distributions in $\pT$ of the ``leading'' and ``subleading'' jet (the jets of, respectively, highest and second-highest $\pT$ in the event),
in the multiplicity of jets and in the observable $\HT$ 
for the inclusive sample and for the sum of inclusive plus exclusive samples in Fig.~\ref{fig:controlPlots_WJets_vs_Njet}.
The distributions are normalized to an integrated luminosity of $140$~fb$^{-1}$, recorded at $\sqrt{s}=13$~\TeV.
Individual exclusive samples $j$ are distinguished by different colors.
The stitching weights $w^{i}$ computed according to Eq.~(\ref{eq:incl}) and given in Table~\ref{tab:weights_WJets_vs_Njet} are applied to the sum of inclusive plus exclusive samples.
Jets are reconstructed using the anti-\kt algorithm~\cite{Cacciari:2008gp,Cacciari:2011ma} with a distance parameter of $0.4$,
using all stable particles except neutrinos as input, and are required to satisfy the selection criteria $\pT > 25\GeV$ and $\vert\eta\vert < 5.0$.
The distributions for the inclusive sample and for the sum of inclusive plus exclusive samples, with the stitching weights applied, are in agreement within the statistical uncertainties.
The exclusive samples reduce the statistical uncertainties in particular in the tails of the distributions,
which are the regions most relevant in searches for new physics.

\begin{table}[h!]
\centering
\resizebox{0.7\textwidth}{!}{
\begin{tabular}{l|c|ccccc}
\hline
\multirow{2}{20mm}{Sample} & Number of events    & \multicolumn{5}{c}{Probabilities}               \\
                           &                     & $p^{0}$ & $p^{1}$ & $p^{2}$ & $p^{3}$ & $p^{4}$ \\
\hline
\hline
Inclusive                  & $XXX \times 10^{6}$ & $0.XXX$ & $0.XXX$ & $0.XXX$ & $0.XXX$ & $0.XXX$ \\
\hline
$N_{\jet} = 1$             & $XXX \times 10^{6}$ & $0$     & $0.XXX$ & $0.XXX$ & $0.XXX$ & $0.XXX$ \\
$N_{\jet} = 2$             & $XXX \times 10^{6}$ & $0$     & $0$     & $0.XXX$ & $0.XXX$ & $0.XXX$ \\
$N_{\jet} = 3$             & $XXX \times 10^{6}$ & $0$     & $0$     & $0$     & $0.XXX$ & $0.XXX$ \\
$N_{\jet} \geq 4$          & $XXX \times 10^{6}$ & $0$     & $0$     & $0$     & $0$     & $1$     \\
\hline
\end{tabular}
}
\caption{
  Number of events in the inclusive and exclusive $\PW \to \Plepton\Pnu$ samples simulated at LO accuracy in pQCD,
  and probabilities $p^{i}$ for the events in the inclusive and exclusive samples to populate the different PS regions $i$.
  The index $i$ equals the observable $N_{\jet}$.
}
\label{tab:samples_and_probabilities_WJets_vs_Njet}
\end{table}

\begin{table}[h!]
\centering
\resizebox{0.7\textwidth}{!}{
\begin{tabular}{l|ccccc}
\hline
 & \multicolumn{5}{c}{Phase-space regions} \\
 & $0$ & $1$ & $2$ & $3$ & $4$ \\
\hline
\hline
Weight & $0.XXX$ & $0.XXX$ & $0.XXX$ & $0.XXX$ & $0.XXX$ \\
\hline
\end{tabular}
}
\caption{
  Weights $w^{i}$ for the case that inclusive and exclusive $\PW \to \Plepton\Pnu$ samples simulated at LO accuracy in pQCD
  are stitched based on the observable $N_{\jet}$.
}
\label{tab:weights_WJets_vs_Njet}
\end{table}

\begin{figure}
\setlength{\unitlength}{1mm}
\begin{center}
\begin{picture}(180,182)(0,0)
%\put(6.5, 100.0){\mbox{\includegraphics*[height=82mm]
%  {plots/leadJet_pT_WJets_vs_Njet.pdf}}}
%\put(81.5, 100.0){\mbox{\includegraphics*[height=82mm]
%  {plots/subleadJet_pT_WJets_vs_Njet.pdf}}}
%\put(6.5, 4.0){\mbox{\includegraphics*[height=82mm]
%  {plots/numJets_WJets_vs_Njet.pdf}}}
%\put(81.5, 4.0){\mbox{\includegraphics*[height=82mm]
%  {plots/HT_WJets_vs_Njet.pdf}}}
\put(43.0, 96.0){\small (a)}
\put(118.0, 96.0){\small (b)}
\put(43.0, 0.0){\small (c)}
\put(118.0, 0.0){\small (d)}
\end{picture}
\end{center}
\caption{
  Distributions in $\pT$ of the (a) leading and (b) subleading jet,
  in (c) the multiplicity of jets and (d) the observable $\HT$,
  for the case that $\PW \to \Plepton\Pnu$ samples generated at LO accuracy in pQCD are stitched based on the observable $N_{\jet}$.
}
\label{fig:controlPlots_WJets_vs_Njet}
\end{figure}


\subsection{Stitching of $\PW$+jets samples by $N_{\jet}$ and $\HT$}
\label{sec:WJets_vs_Njet_and_HT}

This example extends the previous one and demonstrates the stitching procedure based on two observables, $N_{\jet}$ and $\HT$.
The exclusive samples are simulated for jet multiplicities of $N_{\jet} = 1$, $2$, $3$, and $N_{\jet} \geq 4$ 
and for $\HT$ in the ranges $70$-$100$, $100$-$200$, $200$-$400$, $400$-$600$, $600$-$800$, $800$-$1200$, $1200$-$2500$, and $> 2500$~\GeV.
The number of events in the samples simulated in ranges in $\HT$ are given in Table~\ref{tab:samples_WJets_vs_Njet_and_HT}.
The information for the inclusive sample and for the samples simulated in bins of $N_{\jet}$ was given in Table~\ref{tab:samples_and_probabilities_WJets_vs_Njet} already.
The corresponding PS regions $i$, defined in the plane of $N_{\jet}$ versus $\HT$, are shown in Fig.~\ref{fig:regions_WJets_vs_Njet_and_HT}.
In total, the stitching weights $w^{i}$ are computed for $45$ separate PS regions.
The numerical values of these weights are given in Table~\ref{tab:weights_WJets_vs_Njet_and_HT} in the appendix.
Distributions in $\pT$ of the leading and subleading jet,
in jet multiplicity and in the observable $\HT$ 
for the sum of inclusive plus exclusive samples are compared to the distributions obtained for the inclusive sample in Fig.~\ref{fig:controlPlots_WJets_vs_Njet_and_HT}.
We use the same color for all exclusive samples binned in $N_{\jet}$ and another color for all exclusive samples simulated in ranges in $\HT$,
so that one can better see where each of the two sets of samples contribute most.
Below each distribution, we show the relative statistical uncertainties for the four cases that
only the inclusive sample is used, the inclusive sample is used in conjunction with the exclusive samples binned in $N_{\jet}$,
the inclusive sample is used in conjunction with the exclusive samples simulated in ranges in $\HT$,
and for the case that all samples given in Tables~\ref{tab:samples_and_probabilities_WJets_vs_Njet} and~\ref{tab:samples_WJets_vs_Njet_and_HT} are used.
As expected, the samples simulated in ranges in $\HT$ reduce the statistical uncertainties in particular in the tail of the $\HT$ distribution.
Physics analyses that search for new particles of high mass, which decay to high $\pT$ jets, are thus advised to produce MC samples in ranges in $\HT$,
whereas the samples binned in $N_{\jet}$ are particularly well suited when the signal process under study features a large number of low $\pT$ jets.

\begin{table}[h!]
\centering              
\resizebox{0.7\textwidth}{!}{
\begin{tabular}{l|c}
\hline
Sample                   & Number of events \\
\hline
\hline
$  70 < \HT <  100$~\GeV & $XXX \times 10^{6}$ \\
$ 100 < \HT <  200$~\GeV & $XXX \times 10^{6}$ \\
$ 200 < \HT <  400$~\GeV & $XXX \times 10^{6}$ \\
$ 400 < \HT <  600$~\GeV & $XXX \times 10^{6}$ \\
$ 600 < \HT <  800$~\GeV & $XXX \times 10^{6}$ \\
$ 800 < \HT < 1200$~\GeV & $XXX \times 10^{6}$ \\
$1200 < \HT < 2500$~\GeV & $XXX \times 10^{6}$ \\
$       \HT > 2500$~\GeV & $XXX \times 10^{6}$ \\
\hline
\end{tabular}
}
\caption{
  Number of events in the $\PW \to \Plepton\Pnu$ samples simulated at LO accuracy in pQCD and in ranges in $\HT$.
}
\label{tab:samples_WJets_vs_Njet_and_HT}
\end{table}

\begin{figure}
\setlength{\unitlength}{1mm}
\begin{center}
\begin{picture}(180,82)(0,0)
%\put(44.0, 0.0){\mbox{\includegraphics*[height=82mm]
%  {plots/regions_WJets_vs_Njet_and_HT.pdf}}}
\end{picture}
\end{center}
\caption{
  Definition of the PS regions $i$ in the plane of $N_{\jet}$ versus $\HT$,
  for the case that $\PW \to \Plepton\Pnu$ samples generated at LO accuracy in pQCD are stitched based on the observables $N_{\jet}$ and $\HT$.
}
\label{fig:regions_WJets_vs_Njet_and_HT}
\end{figure}

\begin{figure}
\setlength{\unitlength}{1mm}
\begin{center}
\begin{picture}(180,182)(0,0)
%\put(6.5, 100.0){\mbox{\includegraphics*[height=82mm]
%  {plots/leadJet_pT_WJets_vs_Njet_and_HT.pdf}}}
%\put(81.5, 100.0){\mbox{\includegraphics*[height=82mm]
%  {plots/subleadJet_pT_WJets_vs_Njet_and_HT.pdf}}}
%\put(6.5, 4.0){\mbox{\includegraphics*[height=82mm]
%  {plots/numJets_WJets_vs_Njet_and_HT.pdf}}}
%\put(81.5, 4.0){\mbox{\includegraphics*[height=82mm]
%  {plots/HT_WJets_vs_Njet_and_HT.pdf}}}
\put(43.0, 96.0){\small (a)}
\put(118.0, 96.0){\small (b)}
\put(43.0, 0.0){\small (c)}
\put(118.0, 0.0){\small (d)}
[ADD ``RATIO'' PLOT BELOW EACH DISTRIBUTION THAT SHOWS RELATIVE STATISTICAL UNCERTAINTY, DEFINED AS BINERROR/BINCONTENT FOR 3 CASES: 1) INCLUSIVE, 2) STITCHED BY NJET, 3) STITCHED BY NJET AND HT]
\end{picture}
\end{center}
\caption{
  Distributions in $\pT$ of the (a) leading and (b) subleading jet,
  in (c) the multiplicity of jets and (d) the observable $\HT$,
  for the case that $\PW \to \Plepton\Pnu$ samples generated at LO accuracy in pQCD are stitched based on the observables $N_{\jet}$ and $\HT$.
}
\label{fig:controlPlots_WJets_vs_Njet_and_HT}
\end{figure}


\subsection{Stitching of DY samples by $N_{\jet}$}

In case of the $\PZggx \to \Plepton\Plepton$ sample simulated at NLO accuracy in pQCD,
the inclusive sample is stitched with samples binned in jet multiplicity.
The exclusive samples are produced for the case of $0$, $1$, and $2$ jets, using the \MGvATNLO commands:
\texttt{
\qquad generate p p > ell+ ell- [QCD]
}
and
\texttt{
\qquad generate p p > ell+ ell- j [QCD] \\
}
and
\texttt{
\qquad generate p p > ell+ ell- j j [QCD]
}
while the inclusive sample is produced by the command:
\texttt{
\qquad generate p p > ell+ ell- [QCD] \\
\qquad add process p p > ell+ ell- j [QCD] \\
\qquad add process p p > ell+ ell- j j [QCD] \, .
}
A complication in computing the stitching weights arises from the fact that the jets, represented by the symbol \texttt{j} in the above commands,
refer to quarks and gluons that are present at the Born level, while the samples are generated at NLO accuracy.
The NLO matrix element (ME) that is used to generate the samples contains three different parts, 
for Born-level, virtual corrections, and emission of a real gluon, respectively.
While the multiplicity of quark and gluon jets on the ME level matches the multiplicity of the symbols \texttt{j} in the \MGvATNLO commands 
when events are produced by the ME for the Born-level or for the virtual corrections,
events produced with the ME for real gluon emission contain an extra jet at the ME level.
The multiplicity of jets at the ME level is determined by counting the number of quarks and gluons of status $1$ 
that are present in the \textrm{Les Houches Event} (LHE)~\cite{Alwall:2006yp} file produced by the program \MGvATNLO.
The complication for the computation of stitching weights is that only the jet multiplicity at the ME level is stored in the inclusive sample.
We address this complication by determining the probability $p$ that we need for the computation of the stitching weights in Eq.~(\ref{eq:incl})
in a different way for the inclusive sample and for the samples binned in jet multiplicity.
For the inclusive sample, we determine the probability $p(N_{\jet}^{\ME})$ directly from the distribution in the multiplicity of jets at the ME level,
where we use the superscript $^{\ME}$ to refer to the multiplicity of jets at the ME level.
Similarly, we refer to the multiplicity of jets at the Born level using the superscript $^{\Born}$.
For the samples binned in jet multiplicity,
we express the probability $p(N_{\jet}^{\ME})$ as the product of two factors.
The first factor, denoted by the symbol $p(N_{\jet}^{\Born})$, depends on the multiplicity of jets at the Born level, 
which for the exclusive samples corresponds to the multiplicity of the symbols \texttt{j} in the \MGvATNLO commands above.
The factor $p(N_{\jet}^{\Born})$ is determined by taking the ratio of cross sections computed by the program \MGvATNLO 
for the inclusive sample and for the samples binned in jet multiplicity.
The second factor, which we denote by the symbol $p(N_{\jet}^{\ME} \vert N_{\jet}^{\Born})$, depends on the multiplicity of jets at the ME level,
for a given multiplicity of jets at the Born level.
The factor $p(N_{\jet}^{\ME} \vert N_{\jet}^{\Born})$ corresponds to the fraction of events with real gluon emission in each of the exclusive samples.
The number of events in each MC sample and the cross sections computed by the program \MGvATNLO are given in Table~\ref{tab:samples_DYJets_vs_Njet}.
The probability $p(N_{\jet}^{\ME})$ for the inclusive sample is given in Table~\ref{tab:probabilities_inclusive_DYJets_vs_Njet},
while the probabilities $p(N_{\jet}^{\Born})$ and $p(N_{\jet}^{\ME} \vert N_{\jet}^{\Born})$ for the samples binned in jet multiplicity are reported in Table~\ref{tab:probabilities_exclusive_DYJets_vs_Njet}.
The stitching weights, computed according to Eq.~(\ref{eq:incl}), are given in Table~\ref{tab:weights_DJets_vs_Njet}.
The distributions in $\pT$ of the leading and subleading jet,
in jet multiplicity and in the observable $\HT$ 
for inclusive sample and for the sum of inclusive plus exclusive samples are shown in Fig.~\ref{fig:controlPlots_DYJets_vs_Njet}.
The distributions for the inclusive sample and for the sum of inclusive plus exclusive samples are in agreement within the statistical uncertainties,
demonstrating that the stitching procedure produces an unbiased background estimate in this case also.
We again show the relative statistical uncertainties for the cases that only the inclusive sample is used
and for case that the inclusive and exclusive samples are used below each distribution.
Compared to using only the inclusive sample,
the samples binned in jet multiplicity reduce the statistical uncertainties by a similar degree in the NLO case
as was the case for samples simulated at LO accuracy in pQCD, 
shown in Fig.~\ref{fig:controlPlots_WJets_vs_Njet} and in the lower part of Fig.~\ref{fig:controlPlots_WJets_vs_Njet_and_HT}.

\begin{table}[h!]
\centering              
\resizebox{0.7\textwidth}{!}{
\begin{tabular}{l|c|c}
\hline
Sample                 & Number of events    & Cross section [nb]$^{1}$ \\
\hline
\hline
Inclusive              & $XXX \times 10^{6}$ & $XX.XX$ \\
\hline
$N_{\jet}^{\Born} = 0$ & $XXX \times 10^{6}$ & $XX.XX$ \\
$N_{\jet}^{\Born} = 1$ & $XXX \times 10^{6}$ & $XX.XX$ \\
$N_{\jet}^{\Born} = 2$ & $XXX \times 10^{6}$ & $XX.XX$ \\
\hline
\end{tabular}
}
$^{1}$ Computed at at NLO accuracy in pQCD using the program \MGvATNLO
\caption{
  Number of events in the inclusive and exclusive $\PZggx \to \Plepton\Plepton$ samples simulated at NLO accuracy in pQCD,
  and cross sections, computed by the program \MGvATNLO, for each sample.
}
\label{tab:samples_DYJets_vs_Njet}
\end{table}

\begin{table}[h!]
\centering
\resizebox{0.7\textwidth}{!}{
\begin{tabular}{l|cccc}
\hline
\multirow{2}{20mm}{Sample} & \multicolumn{4}{c}{Probability $p(N_{\jet}^{\ME})$} \\
                           & $N_{\jet}^{\ME} = 0$ & $N_{\jet}^{\ME} = 1$ & $N_{\jet}^{\ME} = 2$ & $N_{\jet}^{\ME} = 3$ \\
\hline
\hline
Inclusive                  & $0.XXX$              & $0.XXX$              & $0.XXX$              & $0.XXX$ \\
\hline
\hline
\end{tabular}
}
\caption{
  Probability $p(N_{\jet}^{\ME})$ for the inclusive $\PZggx \to \Plepton\Plepton$ samples simulated at NLO accuracy in pQCD.
}
\label{tab:probabilities_inclusive_DYJets_vs_Njet}
\end{table}

\begin{table}[h!]
\centering
\resizebox{0.7\textwidth}{!}{
\begin{tabular}{l|ccc|cc}
\hline
\multirow{2}{20mm}{Sample} & \multicolumn{3}{c}{Probability $p(N_{\jet}^{\Born})$}                    & \multicolumn{2}{c}{Probability $p(N_{\jet}^{\ME})$} \\
                           & $N_{\jet}^{\Born} = 0$ & $N_{\jet}^{\Born} = 1$ & $N_{\jet}^{\Born} = 2$ & $N_{\jet}^{\ME} = N_{\jet}^{\Born}$ & $N_{\jet}^{\ME} = N_{\jet}^{\Born} + 1$ \\
\hline
\hline
Inclusive                  & $0.XXX$                & $0.XXX$                & $0.XXX$                & $0.XXX$                             & $0.XXX$ \\
\hline
\end{tabular}
}
\caption{
  Probabilities $p(N_{\jet}^{\Born})$ and $p(N_{\jet}^{\ME})$ for the $\PZggx \to \Plepton\Plepton$ samples simulated at NLO accuracy in pQCD and binned in jet multiplicity.
  The probabilities $p(N_{\jet}^{\ME})$ for cases other than $N_{\jet}^{\ME} = N_{\jet}^{\Born}$ and $N_{\jet}^{\ME} = N_{\jet}^{\Born} + 1$ are zero.
}
\label{tab:probabilities_exclusive_DYJets_vs_Njet}
\end{table}

\begin{figure}
\setlength{\unitlength}{1mm}
\begin{center}
\begin{picture}(180,182)(0,0)
%\put(6.5, 100.0){\mbox{\includegraphics*[height=82mm]
%  {plots/leadJet_pT_DYJets_vs_Njet.pdf}}}
%\put(81.5, 100.0){\mbox{\includegraphics*[height=82mm]
%  {plots/subleadJet_pT_DYJets_vs_Njet.pdf}}}
%\put(6.5, 4.0){\mbox{\includegraphics*[height=82mm]
%  {plots/numJets_DYJets_vs_Njet.pdf}}}
%\put(81.5, 4.0){\mbox{\includegraphics*[height=82mm]
%  {plots/HT_DYJets_vs_Njet.pdf}}}
\put(43.0, 96.0){\small (a)}
\put(118.0, 96.0){\small (b)}
\put(43.0, 0.0){\small (c)}
\put(118.0, 0.0){\small (d)}
[ADD ``RATIO'' PLOT BELOW EACH DISTRIBUTION THAT SHOWS RELATIVE STATISTICAL UNCERTAINTY, DEFINED AS BINERROR/BINCONTENT FOR 3 CASES: 1) INCLUSIVE, 2) STITCHED BY NJET]
\end{picture}
\end{center}
\caption{
  Distributions in $\pT$ of the (a) leading and (b) subleading jet,
  in (c) the multiplicity of jets and (d) the observable $\HT$,
  for the case that $\PZggx \to \Plepton\Plepton$ samples generated at NLO accuracy in pQCD are stitched based on the multiplicity of jets at the ME level.
}
\label{fig:controlPlots_DYJets_vs_Njet}
\end{figure}
